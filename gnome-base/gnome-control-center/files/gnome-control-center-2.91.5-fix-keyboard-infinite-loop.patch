From 1423f9c7bd1d8dc65fd6e78c939d1489d27fc015 Mon Sep 17 00:00:00 2001
From: Bastien Nocera <hadess@hadess.net>
Date: Wed, 19 Jan 2011 14:51:34 +0000
Subject: [PATCH] region: Fix infinite loop when selecting Xkb options

Spotted by Arun Raghavan <arun.raghavan@collabora.co.uk>

https://bugzilla.gnome.org/show_bug.cgi?id=639951
---
 panels/region/gnome-region-panel-xkbot.c |   18 ++++++++++--------
 1 files changed, 10 insertions(+), 8 deletions(-)

diff --git a/panels/region/gnome-region-panel-xkbot.c b/panels/region/gnome-region-panel-xkbot.c
index 333aa18..f43be42 100644
--- a/panels/region/gnome-region-panel-xkbot.c
+++ b/panels/region/gnome-region-panel-xkbot.c
@@ -111,14 +111,16 @@ static void
 xkb_options_select (gchar * optionname)
 {
 	gboolean already_selected = FALSE;
-	gchar **options_list = xkb_options_get_selected_list ();
-	if (options_list != NULL) {
-		gchar **option = options_list;
-		while (*option != NULL)
-			if (!strcmp (*option, optionname)) {
-				already_selected = TRUE;
-				break;
-			}
+	gchar **options_list;
+	guint i;
+
+	options_list = xkb_options_get_selected_list ();
+	for (i = 0; options_list != NULL && options_list[i] != NULL; i++) {
+		gchar *option = options_list[i];
+		if (!strcmp (option, optionname)) {
+			already_selected = TRUE;
+			break;
+		}
 	}
 
 	if (!already_selected) {
-- 
1.7.3.2