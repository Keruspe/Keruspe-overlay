--- a/Makefile.am	2010-06-10 12:07:43.512211761 +0200
+++ b/Makefile.am	2010-04-27 21:15:42.000000000 +0200
@@ -1,11 +1,7 @@
 ## Process this file with automake to produce Makefile.in
 ACLOCAL_AMFLAGS = -I m4
 
-SUBDIRS = libsoup
-
-if BUILD_LIBSOUP
-SUBDIRS += tests docs
-endif
+SUBDIRS = libsoup tests docs
 
 EXTRA_DIST =			\
 	libsoup-2.4.pc.in	\
@@ -18,10 +14,7 @@
 
 pkgconfigdir = $(libdir)/pkgconfig
 
-pkgconfig_DATA=
-if BUILD_LIBSOUP
-pkgconfig_DATA += libsoup-2.4.pc
-endif
+pkgconfig_DATA = libsoup-2.4.pc
 
 if BUILD_LIBSOUP_GNOME
 pkgconfig_DATA += libsoup-gnome-2.4.pc
--- a/configure.ac	2010-06-10 12:11:10.324464689 +0200
+++ b/configure.ac	2010-05-25 01:53:21.000000000 +0200
@@ -72,14 +72,6 @@
 dnl *** Checks for glib ***
 dnl ***********************
 
-PKG_PROG_PKG_CONFIG
-enable_ssl=no
-AC_ARG_WITH(libsoup-system,
-   AS_HELP_STRING([--with-libsoup-system], [Use libsoup system library to build(default=no)]),
-   [with_libsoup_system=$withval], [with_libsoup_system=no])
-
-if test "$with_libsoup_system" = "no"; then
-
 AM_PATH_GLIB_2_0(2.21.3,,,gobject gthread gio)
 if test "$GLIB_LIBS" = ""; then
    AC_MSG_ERROR(GLIB 2.21.3 or later is required to build libsoup)
@@ -90,6 +82,23 @@
 AC_SUBST(XML_CFLAGS)
 AC_SUBST(XML_LIBS)
 
+dnl ***********************
+dnl *** Check for Win32 ***
+dnl ***********************
+
+AC_MSG_CHECKING([for Win32])
+case "$host" in
+  *-*-mingw*)
+    os_win32=yes
+    CFLAGS="$CFLAGS -D_REENTRANT"
+    ;;
+  *)
+    os_win32=no
+    ;;
+esac
+AC_MSG_RESULT([$os_win32])
+AM_CONDITIONAL(OS_WIN32, [test $os_win32 = yes])
+
 dnl *******************
 dnl *** Misc checks ***
 dnl *******************
@@ -125,28 +134,9 @@
 AC_SUBST(LIBGNUTLS_CFLAGS)
 AC_SUBST(LIBGNUTLS_LIBS)
 AC_SUBST(SSL_REQUIREMENT)
-fi
 
 dnl This is not supposed to be conditional, but...
 AM_CONDITIONAL(HAVE_SSL, test $enable_ssl != no)
-AM_CONDITIONAL(BUILD_LIBSOUP, test $with_libsoup_system = no)
-
-dnl ***********************
-dnl *** Check for Win32 ***
-dnl ***********************
-
-AC_MSG_CHECKING([for Win32])
-case "$host" in
-  *-*-mingw*)
-    os_win32=yes
-    CFLAGS="$CFLAGS -D_REENTRANT"
-    ;;
-  *)
-    os_win32=no
-    ;;
-esac
-AC_MSG_RESULT([$os_win32])
-AM_CONDITIONAL(OS_WIN32, [test $os_win32 = yes])
 
 
 dnl *********************
@@ -173,11 +163,6 @@
 if test $with_gnome != no; then
 	AC_DEFINE(HAVE_GNOME, 1, [Defined if GNOME support is enabled])
 
-    if test $with_libsoup_system != no; then
-       PKG_CHECK_MODULES(LIBSOUP, libsoup-$SOUP_API_VERSION = $VERSION)
-    fi
-
-
 	PKG_CHECK_MODULES(LIBPROXY, libproxy-1.0, :, [AC_MSG_ERROR(dnl
 [Could not find libproxy:
 
--- a/libsoup/Makefile.am	2010-06-10 12:14:14.876690395 +0200
+++ b/libsoup/Makefile.am	2010-04-27 21:15:42.000000000 +0200
@@ -4,18 +4,17 @@
 LIBWS2_32 = -lws2_32
 endif
 
-INCLUDES=
-lib_LTLIBRARIES = 
-
-if BUILD_LIBSOUP
-
-INCLUDES += 				\
+INCLUDES = 				\
 	-DG_LOG_DOMAIN=\"libsoup\" 	\
 	-I$(top_srcdir)			\
 	$(SOUP_DEBUG_FLAGS)		\
 	$(SOUP_MAINTAINER_FLAGS)	\
 	$(GLIB_CFLAGS)			\
 	$(XML_CFLAGS)			\
+	$(GCONF_CFLAGS)			\
+	$(LIBPROXY_CFLAGS)		\
+	$(SQLITE_CFLAGS)		\
+	$(GNOME_KEYRING_CFLAGS)		\
 	$(LIBGCRYPT_CFLAGS)		\
 	$(LIBGNUTLS_CFLAGS)
 
@@ -92,7 +91,7 @@
 	$(soup_headers)		\
 	soup-enum-types.h
 
-lib_LTLIBRARIES += libsoup-2.4.la
+lib_LTLIBRARIES = libsoup-2.4.la
 
 libsoup_2_4_la_LDFLAGS =	\
 	-version-info $(SOUP_CURRENT):$(SOUP_REVISION):$(SOUP_AGE) -no-undefined
@@ -172,18 +171,10 @@
 	soup-value-utils.c		\
 	soup-xmlrpc.c
 
-endif
-
 if BUILD_LIBSOUP_GNOME
 
 libsoupgnomeincludedir = $(includedir)/libsoup-gnome-2.4/libsoup
 
-INCLUDES += $(LIBSOUP_CFLAGS)  \
-    $(GCONF_CFLAGS)     \
-    $(LIBPROXY_CFLAGS)  \
-    $(SQLITE_CFLAGS)    \
-    $(GNOME_KEYRING_CFLAGS)
-
 libsoupgnomeinclude_HEADERS =	\
 	soup-cookie-jar-sqlite.h\
 	soup-gnome.h		\
@@ -191,12 +182,7 @@
 
 lib_LTLIBRARIES += libsoup-gnome-2.4.la
 
-if BUILD_LIBSOUP
-   libsoup_gnome_2_4_la_LDFLAGS = $(libsoup_2_4_la_LDFLAGS)
-else
-  libsoup_gnome_2_4_la_LDFLAGS =        \
-       -version-info $(SOUP_CURRENT):$(SOUP_REVISION):$(SOUP_AGE) -no-undefined
-endif
+libsoup_gnome_2_4_la_LDFLAGS = $(libsoup_2_4_la_LDFLAGS)
 
 libsoup_gnome_2_4_la_LIBADD =		\
 	libsoup-2.4.la			\
@@ -206,12 +192,6 @@
 	$(SQLITE_LIBS)			\
 	$(GNOME_KEYRING_LIBS)
 
-if BUILD_LIBSOUP
-  libsoup_gnome_2_4_la_LIBADD += libsoup-2.4.la
-else
-  libsoup_gnome_2_4_la_LIBADD += $(LIBSOUP_LIBS)
-endif
-
 libsoup_gnome_2_4_la_SOURCES =		\
 	soup-cookie-jar-sqlite.c	\
 	soup-gnome-features.c		\
@@ -282,4 +262,3 @@
 	soup-marshal.list		\
 	soup-enum-types.h.tmpl		\
 	soup-enum-types.c.tmpl
-
